var B=(e,o,s)=>new Promise((t,a)=>{var r=i=>{try{p(s.next(i))}catch(n){a(n)}},c=i=>{try{p(s.throw(i))}catch(n){a(n)}},p=i=>i.done?t(i.value):Promise.resolve(i.value).then(r,c);p((s=s.apply(e,o)).next())});var b=e=>{var o;return e?Array.isArray(e)?(o=e==null?void 0:e.reduce((s,t)=>s+(t[0]!=="\u204D"&&t[0]!=="\u2023"?t[0]:""),""))!=null?o:"":e:""};function _(e,o){var s,t;if((s=e.properties)!=null&&s.title)return b(e.properties.title);if(e.type==="collection_view_page"||e.type==="collection_view"){let a=(t=o.collection[e.collection_id])==null?void 0:t.value;if(a)return b(a.name)}return""}function P(e,o){var s,t,a;if((s=e.format)!=null&&s.page_icon)return(t=e.format)==null?void 0:t.page_icon;if(e.type==="collection_view_page"||e.type==="collection_view"){let r=(a=o.collection[e.collection_id])==null?void 0:a.value;if(r)return r.icon}return null}function N(e){var s;let o=(s=e.block[Object.keys(e.block)[0]])==null?void 0:s.value;return o?_(o,e):null}function w(e,o,s){var t;try{if(!o.properties||!Object.keys(s.collection))return null;let a=(t=s.collection[o.parent_id])==null?void 0:t.value;if(a){let r=Object.keys(a.schema).find(i=>{var n;return((n=a.schema[i])==null?void 0:n.name)===e});if(!r)return null;let{type:c}=a.schema[r],p=b(o.properties[r]);switch(c){case"created_time":return o.created_time;case"multi_select":return p.split(",");case"date":{let n=o.properties[r][0][1][0][1];if(n.type=="datetime")return new Date(`${n.start_date} ${n.start_time}`).getTime();if(n.type=="date")return new Date(n.start_date).getTime();if(n.type=="datetimerange"){let{start_date:u,start_time:d,end_date:m,end_time:l}=n,y=new Date(`${u} ${d}`).getTime(),g=new Date(`${m} ${l}`).getTime();return[y,g]}else{let u=new Date(n.start_date).getTime(),d=new Date(n.end_date).getTime();return[u,d]}}case"checkbox":return p=="Yes";case"last_edited_time":return o.last_edited_time;default:return p}}}catch(a){}return null}var $=e=>{if(e&&Array.isArray(e)){if(e[0]==="d")return e[1];for(let o of e){let s=$(o);if(s)return s}}return null};var E=(e,o,{inclusive:s=!1}={})=>{var a,r;let t=e;for(;t!=null;){if(s&&(t==null?void 0:t.type)==="page")return t;let c=t.parent_id,p=t.parent_table;if(!c)break;if(p==="collection")t=(a=o.collection[c])==null?void 0:a.value;else if(t=(r=o.block[c])==null?void 0:r.value,(t==null?void 0:t.type)==="page")return t}return null};var D={header:0,sub_header:1,sub_sub_header:2},ee=(e,o)=>{var a;let s=((a=e.content)!=null?a:[]).map(r=>{var p,i;let c=(p=o.block[r])==null?void 0:p.value;if(c){let{type:n}=c;if(n==="header"||n==="sub_header"||n==="sub_sub_header")return{id:r,type:n,text:b((i=c.properties)==null?void 0:i.title),indentLevel:D[n]}}return null}).filter(Boolean),t=[{actual:-1,effective:-1}];for(let r of s){let{indentLevel:c}=r,p=c;do{let i=t[t.length-1],{actual:n,effective:u}=i;if(p>n)r.indentLevel=u+1,t.push({actual:p,effective:r.indentLevel});else if(p===n){r.indentLevel=u;break}else t.pop()}while(!0)}return s};var re=(e,o)=>{var r,c,p;let s=o||Object.keys(e.block)[0],t=new Set;function a(i){var m;if(t.has(i))return;t.add(i);let n=(m=e.block[i])==null?void 0:m.value;if(!n)return;let{content:u,type:d}=n;if(!!u&&!(d==="page"&&i!==s))for(let l of u)a(l)}a(s);for(let i of Object.keys(e.block)){let n=(r=e.block[i])==null?void 0:r.value;if(!n)continue;let{properties:u}=n;if(u)for(let d of Object.keys(u)){let m=u[d];m.map(y=>{var f,k;let g=(k=(f=y==null?void 0:y[0])==null?void 0:f[1])==null?void 0:k[0];(g==null?void 0:g[0])==="p"&&g[1]&&t.add(g[1])});let l=(p=(c=m==null?void 0:m[0])==null?void 0:c[1])==null?void 0:p[0];(l==null?void 0:l[0])==="p"&&l[1]&&t.add(l[1])}}return Array.from(t)};var R=(e="")=>`${e.substr(0,8)}-${e.substr(8,4)}-${e.substr(12,4)}-${e.substr(16,4)}-${e.substr(20)}`;var I=/\b([a-f0-9]{32})\b/,O=/\b([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})\b/,C=(e="",{uuid:o=!0}={})=>{if(!e)return null;e=e.split("?")[0];let s=e.match(I);if(s)return o?R(s[1]):s[1];let t=e.match(O);return t?o?t[1]:t[1].replace(/-/g,""):null};var U=e=>e.replace(/-/g,"");import A from"p-queue";function pe(c,p,i){return B(this,arguments,function*(e,o,s,{concurrency:t=4,traverseCollections:a=!0,targetPageId:r=null}={}){let n={},u=new Set,d=new A({concurrency:t});function m(l){return B(this,null,function*(){r&&u.has(r)||(l=C(l),l&&!n[l]&&!u.has(l)&&(u.add(l),d.add(()=>B(this,null,function*(){var y,g;try{if(r&&u.has(r)&&l!==r)return;let f=yield s(l);if(!f)return;let k=(g=(y=f.block[l])==null?void 0:y.value)==null?void 0:g.space_id;if(!o)o=k;else if(o!==k)return;if(Object.keys(f.block).filter(v=>{var h;let x=(h=f.block[v])==null?void 0:h.value;return x?(x.type==="page"||x.type==="collection_view_page")&&x.space_id===o:!1}).forEach(v=>m(v)),a)for(let v of Object.values(f.collection_query))for(let x of Object.values(v)){let{blockIds:T}=x;if(T)for(let h of T)m(h)}n[l]=f}catch(f){console.warn("page load error",{pageId:l,spaceId:o},f.statusCode,f.message),n[l]=null}u.delete(l)}))))})}return yield m(e),yield d.onIdle(),n})}var de=(e,o,{uuid:s=!0}={})=>{var r;if(!e||!o)return null;let t=U(e),a=(r=o.block[e])==null?void 0:r.value;if(a){let c=w("slug",a,o)||w("Slug",a,o)||j(_(a,o));if(c)return s?`${c}-${t}`:c}return t},j=e=>(e||"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-\u4e00-\u9fa5]/g,"").replace(/--/g,"-").replace(/-$/,"").replace(/^-/,"").trim().toLowerCase();var _e=(e,o)=>{var r;let s=e.block,t=[],a=o;do{let c=(r=s[a])==null?void 0:r.value;if(!c)break;let p=_(c,e),i=P(c,e);if(!(p||i))break;t.push({block:c,active:a===o,pageId:a,title:p,icon:i});let n=E(c,e),u=n==null?void 0:n.id;if(!u)break;a=u}while(!0);return t.reverse(),t};import L from"is-url-superb";var Pe=(e,{mapImageUrl:o})=>{let t=Object.keys(e.block).flatMap(a=>{var p,i,n,u,d,m,l,y;let r=(p=e.block[a])==null?void 0:p.value,c=[];if(r){if(r.type==="image"){let k=((i=e.signed_urls)==null?void 0:i[r.id])||((d=(u=(n=r.properties)==null?void 0:n.source)==null?void 0:u[0])==null?void 0:d[0]);k&&c.push({block:r,url:k})}if((m=r.format)!=null&&m.page_cover){let f=r.format.page_cover;c.push({block:r,url:f})}if((l=r.format)!=null&&l.bookmark_cover){let f=r.format.bookmark_cover;c.push({block:r,url:f})}if((y=r.format)!=null&&y.bookmark_icon){let f=r.format.bookmark_icon;c.push({block:r,url:f})}let g=P(r,e);g&&L(g)&&c.push({block:r,url:g})}return c}).filter(Boolean).map(({block:a,url:r})=>o(r,a)).filter(Boolean);return Array.from(new Set(t))};import M from"normalize-url";import z from"mem";var F=z(e=>{if(!e)return"";try{if(e.startsWith("https://www.notion.so/image/")){let o=new URL(e),s=decodeURIComponent(o.pathname.substr(7)),t=F(s);o.pathname=`/image/${encodeURIComponent(t)}`,e=o.toString()}return M(e,{stripProtocol:!0,stripWWW:!0,stripHash:!0,stripTextFragment:!0,removeQueryParameters:!0})}catch(o){return""}});export{pe as getAllPagesInSpace,P as getBlockIcon,E as getBlockParentPage,_ as getBlockTitle,de as getCanonicalPageId,$ as getDateValue,_e as getPageBreadcrumbs,re as getPageContentBlockIds,Pe as getPageImageUrls,w as getPageProperty,ee as getPageTableOfContents,N as getPageTitle,b as getTextContent,R as idToUuid,j as normalizeTitle,F as normalizeUrl,C as parsePageId,U as uuidToId};
//# sourceMappingURL=index.js.map